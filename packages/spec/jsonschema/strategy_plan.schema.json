{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://pathfinder.veupathdb.org/schemas/strategy_plan.json",
  "title": "StrategyPlan",
  "description": "Internal DSL for representing VEuPathDB search strategies as an AST",
  "type": "object",
  "properties": {
    "recordType": {
      "type": "string",
      "description": "The record type this strategy operates on (e.g., gene, transcript, snp)"
    },
    "root": {
      "$ref": "#/$defs/PlanStepNode",
      "description": "The root node of the strategy tree"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "siteId": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }
      }
    }
  },
  "required": ["recordType", "root"],
  "$defs": {
    "PlanStepNode": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Local step ID for referencing"
        },
        "searchName": {
          "type": "string",
          "description": "Name of the underlying WDK question/search"
        },
        "displayName": {
          "type": "string",
          "description": "Human-readable name for this step"
        },
        "parameters": {
          "type": "object",
          "additionalProperties": true,
          "description": "WDK question parameters as key-value pairs"
        },
        "primaryInput": {
          "$ref": "#/$defs/PlanStepNode",
          "description": "Primary input step (unary/binary operations)"
        },
        "secondaryInput": {
          "$ref": "#/$defs/PlanStepNode",
          "description": "Secondary input step (binary operations)"
        },
        "operator": {
          "$ref": "#/$defs/CombineOperator"
        },
        "colocationParams": {
          "$ref": "#/$defs/ColocationParams",
          "description": "Parameters for genomic colocation (only when operator is COLOCATE)"
        }
      },
      "required": ["searchName"],
      "additionalProperties": false
    },
    "CombineOperator": {
      "type": "string",
      "enum": ["INTERSECT", "UNION", "MINUS", "RMINUS", "COLOCATE"],
      "description": "Set operation for combining two steps"
    },
    "ColocationParams": {
      "type": "object",
      "properties": {
        "upstream": {
          "type": "integer",
          "minimum": 0,
          "description": "Upstream distance in base pairs"
        },
        "downstream": {
          "type": "integer",
          "minimum": 0,
          "description": "Downstream distance in base pairs"
        },
        "strand": {
          "type": "string",
          "enum": ["same", "opposite", "both"],
          "default": "both"
        }
      },
      "additionalProperties": false
    }
  }
}

